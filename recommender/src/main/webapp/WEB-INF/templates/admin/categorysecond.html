<!DOCTYPE html>
<html ng-app="categorysecondApp" ng-controller="categorysecondCtrl">

	<head>
		<meta charset="utf-8">
		<link href="../static/plugins/bootstrap-3.3.6/css/bootstrap.min.css" rel="stylesheet">
		<link href="../static/css/category.css" rel="stylesheet">
		<link href="../static/css/reset.css" rel="stylesheet">
		<script type="text/javascript" src="../static/plugins/jquery-2.1.4/jquery.min.js"></script>
		<script type="text/javascript" src="../static/plugins/angular-1.5.8/angular.min.js"></script>
	</head>

	<body>
		<div class="main-body">
			<!--菜单栏-->
			<div id="menu" class="row menu-bar">
				<div class="col-md-6 col menu-bar-col banner">
					<label class="txt banner">后台管理系统</label>
				</div>
			</div>
			<div class="container main full-size">
				<div class="row">
					<div class="jumbotron">
						<div class="col-md-12 column">
							<ul class="breadcrumb" style="background-color: #fff">
								<li>
									<a href="toCategory">一级分类管理</a>
								</li>
								<li class="active">
									二级分类管理
								</li>
								<li>
									<a href="toProduct">商品管理</a>
								</li>

								<li>
									<a href="toOrder">订单管理</a>
								</li>
								<li>
									<a href="adminLogout">退出</a>
								</li>
							</ul>
						</div>
						<table class="table table-condensed table-bordered" ng-show="!edit&&!add">
							<thead>
								<tr>
									<th>
										编号
									</th>
									<th>
										所属一级分类
									</th>
									<th>
										二级分类名称
									</th>
									<th>
										编辑
									</th>
									<th>
										删除
									</th>
								</tr>
							</thead>
							<tbody>
								<tr ng-repeat="categorySecond in csList">
									<td>
										{{categorySecond.csid}}
									</td>
									<td>
										{{categorySecond.cname}}
									</td>
									<td>
										<span>{{categorySecond.csname}}</span>
									</td>

									<td style="width: 65px;text-align: center;">
										<a href="" ng-click="toEdit(categorySecond)">
											<span class="glyphicon glyphicon-pencil"></span>编辑
										</a>
									</td>
									<td style="width: 65px;text-align: center;">
										<a href="" ng-click="deleteCs(categorySecond)">
											<span class="glyphicon glyphicon-remove"></span>删除
										</a>
									</td>
								</tr>
								
								<!--一行--->

							</tbody>
						</table>
						<div style="text-align: right;margin-right: 200px;">
							<button ng-show="!add && !edit2" class="btn btn-default" ng-click="add=true">添加</button>
						</div>
						<!--修改-->
						<div class="form-horizontal" role="form" ng-show="edit">
							<div class="form-group">
								<label for="csName" class="col-sm-2 control-label">二级分类名</label>
								<div class="col-sm-10" style="width: 400px;">
									<input type="text" class="form-control" id="csName" ng-model="updateCs.csname" />
								</div>
							</div>
							<div class="form-group">
								<label for="category" class="col-sm-2 control-label">所属一级分类</label>
								<div class="col-sm-10" style="width: 300px;">
									<select id="category" class="form-control" ng-model="updateCs.cid" ng-options="category.cid as category.cname for category in cList">
								      <option value="" >-- 选择所属一级分类 --</option>
								    </select>
								</div>
							</div>

							<div class="form-group">
								<div class="col-sm-offset-2 col-sm-10">
									<button type="submit" class="btn btn-default" ng-click="updateCategorysecond(updateCs)">保存</button>
								</div>
							</div>
						</div>
						<!--新增-->
						<div class="form-horizontal" role="form" ng-show="add">
							<div class="form-group">
								<label for="csName" class="col-sm-2 control-label">二级分类名</label>
								<div class="col-sm-10" style="width: 400px;">
									<input type="text" class="form-control" id="csName" ng-model="newCs.csname" />
								</div>
							</div>
							<div class="form-group">
								<label for="category" class="col-sm-2 control-label">所属一级分类</label>
								<div class="col-sm-10" style="width: 300px;">
									<select id="category" class="form-control" ng-model="newCs.cid" ng-options="category.cid as category.cname for category in cList">
								      <option value="" >-- 选择所属一级分类 --</option>
								    </select>
								</div>
							</div>

							<div class="form-group">
								<div class="col-sm-offset-2 col-sm-10">
									<button type="submit" class="btn btn-default" ng-click="saveCategorysecond(newCs)">保存</button>
								</div>
							</div>
						</div>

					</div>
				</div>

			</div>
		</div>
		<!--底部-->
		<!--<div id="bottom" class="bottom-bar">
			<div>
				<span>Copyright © 2017-2017 易淘版权所有&nbsp;|&nbsp;版本:Beta1</span>
			</div>
		</div>-->

		<script>
			var myModule = angular.module("categorysecondApp", []);
			myModule.controller('categorysecondCtrl', function($scope, $http) {
				$scope.edit = false;
				$scope.add = false;
				$scope.detele={};
				$scope.updateCs={};
				//加载二级分类列表
				$http.get("admin/getCategorySecondList")
					.success(function(response) {
						$scope.csList = response;

					});

				//加载一级分类列表
				$http.get("admin/getCategoryList")
					.success(function(response) {
						$scope.cList = response;

					});
				//显示编辑表
				$scope.toEdit=function(categorySecond){
					$scope.edit=true;
					
					$scope.updateCs.csname=categorySecond.csname;
					$scope.updateCs.csid=categorySecond.csid;
					$scope.updateCs.cid=categorySecond.category.cid;
					
				}
				//删除二级分类
				$scope.deleteCs = function(categorySecond) {
					$scope.detele.csid=categorySecond.csid;
						$http({
							method: 'POST',
							url: 'admin/deleteCategorySecond',
							data: $.param($scope.detele), // pass in data as strings
							headers: {
								'Content-Type': 'application/x-www-form-urlencoded'
							} // set the headers so angular passing info as form data (not request payload)
						}).success(function(response) {
							$scope.csList = response;
						});
					}
				//修改二级分类
				$scope.updateCategorysecond = function(updateCs) {
						$scope.edit = false;
						$http({
							method: 'POST',
							url: 'admin/updateCategorySecond',
							data: $.param(updateCs), // pass in data as strings
							headers: {
								'Content-Type': 'application/x-www-form-urlencoded'
							} // set the headers so angular passing info as form data (not request payload)
						}).success(function(response) {
							$scope.csList = response;
						});
					}
				//添加二级分类
				$scope.saveCategorysecond = function(newCs) {
					$scope.edit = false;
					$scope.add = false;
					$http({
						method: 'POST',
						url: 'admin/addCategorySecond',
						data: $.param(newCs), // pass in data as strings
						headers: {
							'Content-Type': 'application/x-www-form-urlencoded'
						} // set the headers so angular passing info as form data (not request payload)
					}).success(function(response) {
						$scope.csList = response;
					});
				}

				//

			});
		</script>
	</body>

</html>
<!DOCTYPE html>
<html ng-app="modulesApp" ng-controller="modulesAppCtrl">

	<head>
		<meta charset="utf-8">
		<link href="../static/plugins/bootstrap-3.3.6/css/bootstrap.min.css" rel="stylesheet">
		<link href="../static/css/category.css" rel="stylesheet">
		<link href="../static/css/reset.css" rel="stylesheet">
		<link href="../static/plugins/bootstrap-datetimepicker/css/bootstrap-datetimepicker.min.css" rel="stylesheet">
		<link href="../static/css/adminProduct.css" rel="stylesheet">
		<script type="text/javascript" src="../static/plugins/jquery-2.1.4/jquery.min.js"></script>
		<script type="text/javascript" src="../static/plugins/angular-1.5.8/angular.min.js"></script>
		<script type="text/javascript" src="../static/plugins/bootstrap-3.3.6/js/bootstrap.min.js"></script>
		<script type="text/javascript" src="../static/plugins/bootstrap-datetimepicker/js/bootstrap-datetimepicker-custom.min.js" charset="UTF-8"></script>
		<script type="text/javascript" src="../static/plugins/bootstrap-datetimepicker/js/locales/bootstrap-datetimepicker.zh-CN.js" charset="UTF-8"></script>

	</head>

	<body>
		<div class="main-body">

			<!--菜单栏-->
			<div id="menu" class="row menu-bar">
				<div class="col-md-6 col menu-bar-col banner">
					<label class="txt banner">后台管理系统</label>
				</div>
			</div>
			<div class="container main full-size">
				<div class="row">
					<div class="jumbotron">
						<div class="col-md-12 column">
							<ul class="breadcrumb" style="background-color: #fff">
								<li>
									<a href="toCategory">一级分类管理</a>
								</li>
								<li>
									<a href="toCategorysecond">二级分类管理</a>
								</li>
								<li class="active">
									商品管理
								</li>

								<li>
									<a href="toOrder">订单管理</a>
								</li>
							</ul>
						</div>
						<div>
							{{message.info}}
						</div>
						<div style="text-align: right;margin-right: 200px;margin-bottom: 10px;">
							<button ng-show="!add&&!edit" class="btn btn-default" ng-click="add=true">添加</button>
						</div>
						<table class="table table-condensed table-bordered" ng-show="!edit&&!add">
							<thead>
								<tr>
									<th>
										编号
									</th>
									<th>
										商品图片
									</th>
									<th>
										商品名称
									</th>
									<th>
										商品价格
									</th>
									<th>
										是否热门
									</th>
									<th>
										编辑
									</th>
									<th>
										删除
									</th>
								</tr>
							</thead>
							<tbody>
								<tr ng-repeat="product in pList">
									<td>
										{{product.pid}}
									</td>
									<td>
										<img ng-src="{{product.image}}" style="height: 60px;" />
									</td>

									<td>
										{{product.pname}}
									</td>
									<td>
										{{product.shop_price}}
									</td>
									<td ng-switch="product.is_hot">
										<span ng-switch-when=1>是</span>
										<span ng-switch-when=0>否</span>
									</td>
									<td style="width: 65px;text-align: center;">
										<a href="" ng-click="toEdit(product)">
											<span class="glyphicon glyphicon-pencil"></span>编辑
										</a>

									</td>
									<td style="width: 65px;text-align: center;">
										<a href="" ng-click="deleteProduct(product)">
											<span class="glyphicon glyphicon-remove"></span>删除
										</a>
									</td>
								</tr>
								<!--一行--->
								<!--分页-->
								<tr>
									<td colspan="7" style="text-align: right;">
										<ul class="pagination pagination-sm">
											<li>
												<a href="#">Prev</a>
											</li>
											<li>
												<a href="#">1</a>
											</li>
											<li>
												<a href="#">2</a>
											</li>
											<li>
												<a href="#">3</a>
											</li>
											<li>
												<a href="#">4</a>
											</li>
											<li>
												<a href="#">5</a>
											</li>
											<li>
												<a href="#">Next</a>
											</li>
										</ul>
									</td>
								</tr>

							</tbody>
						</table>
						<!--添加商品-->

						<div ng-show="add||edit">
							<form class="form-horizontal" role="form">
								<div class="form-group">
									<label for="productName" class="col-sm-2 control-label" ng-model="newProduct.pname">商品名称</label>
									<div class="col-sm-5">
										<input type="text" class="form-control" id="productName" ng-model="newProduct.pname" />
									</div>
									<div class="col-sm-5"></div>
								</div>
								<div class="form-group">
									<label for="marketPrice" class="col-sm-2 control-label">市场价格</label>
									<div class="col-sm-5">
										<input ng-model="newProduct.market_price" type="text" class="form-control" id="marketPrice" />
									</div>
									<div class="col-sm-5"></div>
								</div>
								<div class="form-group">
									<label for="shopPrice" class="col-sm-2 control-label">商城价格</label>
									<div class="col-sm-5">
										<input ng-model="newProduct.shop_price" type="text" class="form-control" id="shopPrice" />
									</div>
									<div class="col-sm-5"></div>
								</div>
								<div class="form-group">
									<label for="pdate" class="col-sm-2 control-label">出版日期</label>
									<div class="col-sm-5">
										<div class="input-group date">
											<input id="pdate" type="text" ng-model="newProduct.pdate" class="form-control" maxlength="16">
											<span class="input-group-addon glyphicon glyphicon-calendar"><i class="fa fa-calendar"></i></span>
										</div>
									</div>
									<div class="col-sm-5">

									</div>
								</div>
								<div class="form-group">
									<label for="ishot" class="col-sm-2 control-label">是否热门</label>
									<div class="col-sm-2">
										<select id="ishot" class="form-control" ng-model="newProduct.is_hot">
										  <option value="1">是</option>
										  <option value="0">否</option>
										</select>
									</div>
									<div class="col-sm-8"></div>
								</div>
								<div class="form-group">
									<label for="upload" class="col-sm-2 control-label">商品图片</label>
									<div class="col-sm-10">
										<input type="file" id="upload" name="file" />
									</div>
								</div>
								<div class="form-group">
									<label for="categorysecond" class="col-sm-2 control-label">所属二级分类</label>
									<div class="col-sm-4">
										<select id="categorysecond" class="form-control" ng-model="newProduct.csid" ng-options="cs.csid as cs.csname for cs in csList">
									      <option value="" >-- 选择所属二级分类 --</option>
									    </select>
									</div>
									<div class="col-sm-6"></div>
								</div>

								<div class="form-group">
									<label for="pdesc" class="col-sm-2 control-label">商品描述</label>
									<div class="col-sm-4">
										<textarea ng-model="newProduct.pdesc" name="pdesc" rows="5" cols="30" class="form-control" id=pdesc></textarea>
									</div>
									<div class="col-sm-6"></div>
								</div>
								<div class="form-group">
									<div class="col-sm-offset-2 col-sm-10">
										<button type="submit" class="btn btn-default" ng-click="addProduct(newProduct)">保存</button>
									</div>
								</div>

							</form>
						</div>

					</div>
				</div>

			</div>
		</div>
		{{aa}}

		<!--add{{add}} edit{{edit}}
		<div id="bottom" class="bottom-bar">
			<div>
				<span>Copyright © 2017-2017 易淘版权所有&nbsp;|&nbsp;版本:Beta1</span>
			</div>
		</div>-->

		<script type="text/javascript">
			var myModule = angular.module("modulesApp",[]);

			myModule.controller('modulesAppCtrl', function($scope, $http) {
				$scope.edit = false;
				$scope.add = false;
				$scope.detele = {};
				//加载商品列表
				$http.get("getProductList")
					.success(function(response) {
						$scope.pList = response;

					});
				//加载二级分类列表
				$http.get("getCategorySecondList")
					.success(function(response) {
						$scope.csList = response;
					});
				//删除
				$scope.deleteProduct = function(product) {
						$scope.detele.pid = product.pid;
						$http({
							method: 'POST',
							url: 'deleteProduct',
							data: $.param($scope.detele), // pass in data as strings
							headers: {
								'Content-Type': 'application/x-www-form-urlencoded'
							} // set the headers so angular passing info as form data (not request payload)
						}).success(function(response) {
							$scope.pList = response;
						});

					}
					//显示编辑表
				$scope.toEdit = function(product) {
					$scope.edit = true;
					$scope.newProduct = product;
					$scope.newProduct.csid = product.categorySecond.csid;
				}

				//添加商品
				$scope.addProduct = function(newProduct) {
					$scope.add = false;
					$scope.edit = false;
					var fd = new FormData();
					var file = document.querySelector('input[type=file]').files[0];
					fd.append('file', file);
					$http({
						method: 'POST',
						url: 'uploadImage',
						data: fd, // pass in data as strings
						headers: {
							'Content-Type': undefined
						},
						transformRequest: angular.identity

					}).success(function(response) {
						$scope.message = response;
						$scope.newProduct.image = response.param;
						$http({
							method: 'POST',
							url: 'addProduct',
							data: $.param(newProduct), // pass in data as strings
							headers: {
								'Content-Type': 'application/x-www-form-urlencoded'
							}

						}).success(function(response) {
							$scope.pList = response;
						});

					}).error(function(response) {
						$scope.message = response;
					});
				}
			});

			//
			$(function() {
				//加载时间选择插件
				$('.input-group.date').datetimepicker({
					format: "yyyy-mm-dd",
					todayHighlight: true,
					language: "zh-CN",
					autoclose: true,
					minView: 2
				});

			});
		</script>
	</body>

</html>